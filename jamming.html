<!DOCTYPE html>
<html>
<head>
  <title></title>

  <link rel="stylesheet" type="text/css" href="index.css">

  <script src="webmidi.js" type="text/javascript"></script>
  <script src="inc/shim/Base64.js" type="text/javascript"></script>
  <script src="inc/shim/Base64binary.js" type="text/javascript"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/5.3.0/firebase.js"></script>
  <script src="config/firebase_config.js"></script>

</script>
<body>
  <center>
    Welcome! You chose Piano for this session.
  </center>
</body>

<script type="text/javascript">
function play(keynote) {

MIDI.loadPlugin({
  soundfontUrl: "./soundfont/",
  // instrument: "acoustic_grand_piano",
  instrument: "steel_drums",
  onprogress: function(state, progress) {
    // console.log(state, progress);
  },
  onsuccess: function() {
    MIDI.programChange(0, MIDI.GM.byName["steel_drums"].number);
    var delay = 0; // play one note every quarter second
    var note = keynote; // the MIDI note
    var velocity = 127; // how hard the note hits
    // play the note
    MIDI.setVolume(0, 127);
    MIDI.noteOn(0, note, velocity, delay);
    MIDI.noteOff(0, note, delay + 0.75);
  }
});
};

function save(){
alert(midi);
}


function play_midi(){
var mapkey = { 65: 48,
               87: 49,
               83: 50,
               69: 51,
               68: 52,
               70: 53,
               84: 54,
               71: 55,
               89: 56,
               72: 57,
               85: 58,
               74: 59
             }
for (var i = 0; i < midi.length; i++){
var element = midi[0+i].note
  play();
}
}

</script>
<script>

var midi = [];

document.onkeydown = function (e) {

  midi.push({note: e.keyCode, velocity:0, delay:0}, e.timeStamp)
  switch (e.keyCode) {
    case 65: //a
        play(48);
        break;
    case 83: //s
        play(50);
    break;
    case 68: //d
        play(52);
    break;
    case 70: //f
        play(53);
    break;
    case 71: //g
        play(55);
    break;
    case 72: //h
        play(57);
    break;
    case 74: //j
        play(59);
    break;
    case 87: //w
        play(49);
    break;
    case 69: //e
        play(51);
    break;
    case 84: //t
        play(54);
    break;
    case 89: //y
        play(56);
    break;
    case 85: //u
        play(58);
    break;
    default:
        return; // Do nothing for the rest
  }
};

</script>

</head>

<div id="kbd">

      <div id="keys">

          <ul class="set">
              <li class="white b"></li>
              <li class="black as"></li>
              <li class="white a"></li>
              <li class="black gs"></li>
              <li class="white g"></li>
              <li class="black fs"></li>
              <li class="white f"></li>
              <li class="white e"></li>
              <li class="black ds"></li>
              <li class="white d"></li>
              <li class="black cs"></li>
              <li class="white c"></li>
          </ul>

      </div>
      <br/>
      <br/>
      <br/>
      <center>
        <button onclick="save()"> Save </button>
      <br/>
      <button onclick="play_midi()"> Play </button>
    </center>

  </div>

<script>

function getCookie(cookieName){
    var decodedcookie = decodeURIComponent(document.cookie);
    var tokenindex = decodedcookie.indexOf(cookieName+"=");
    var aftertokenindex = decodedcookie.slice(tokenindex);
    var array = aftertokenindex.split("=");
    return array[1]
    }

	alert(getCookie("test_cookie"));

    </script>

  </html>
